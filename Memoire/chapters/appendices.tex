%====================================================================
% Annexes - SecureIoT-VIF Community Edition
%====================================================================

\chapter{Annexes}
\label{chap:appendices}

\section{Code source principal SecureIoT-VIF Community}
\label{app:source-code}

Cette annexe présente les extraits de code source les plus significatifs de SecureIoT-VIF Community Edition.

\subsection{Configuration principale}

\lstset{language=C}
\begin{lstlisting}[caption={Fichier de configuration secureiot\_config.h}]
#ifndef SECUREIOT_CONFIG_H
#define SECUREIOT_CONFIG_H

// Configuration Community Edition
#define SECUREIOT_VERSION_MAJOR 1
#define SECUREIOT_VERSION_MINOR 0
#define SECUREIOT_VERSION_PATCH 0
#define SECUREIOT_VERSION_TYPE "Community"

// Configuration crypto (software only)
#define SECUREIOT_CRYPTO_SOFTWARE_ONLY 1
#define SECUREIOT_USE_MBEDTLS 1
#define SECUREIOT_HARDWARE_ACCELERATION 0

// Configuration de vérification
#define FIRMWARE_CHUNK_SIZE (4 * 1024)  // 4KB blocks
#define MAX_FIRMWARE_BLOCKS 512
#define VERIFICATION_INTERVAL_MS (5 * 60 * 1000)  // 5 minutes

// Configuration anomaly detection
#define ANOMALY_DETECTION_INTERVAL_MS (30 * 1000)  // 30 seconds
#define CPU_THRESHOLD_HIGH_PERCENT 80
#define MEMORY_THRESHOLD_LOW_KB 50
#define TEMPERATURE_THRESHOLD_HIGH_C 45.0
#define TEMPERATURE_THRESHOLD_LOW_C 15.0

// Configuration éducative
#define EDUCATIONAL_LOGGING 1
#define DETAILED_DEBUG_OUTPUT 1
#define PERFORMANCE_METRICS 1

#endif // SECUREIOT_CONFIG_H
\end{lstlisting}

\section{Schémas de déploiement éducatif}
\label{app:deployment}

\subsection{Architecture matérielle minimale}

\begin{figure}[h]
    \centering
    \begin{tikzpicture}[scale=0.8]
        % ESP32
        \draw[thick] (0,0) rectangle (4,2);
        \node at (2,1) {ESP32-WROOM-32};
        
        % DHT22
        \draw[thick] (6,0) rectangle (8,1.5);
        \node at (7,0.75) {DHT22};
        
        % Connexions
        \draw[thick] (4,1) -- (6,0.75);
        \node at (5,1.2) {GPIO};
        
        % Alimentation
        \draw[thick] (1,2) -- (1,3);
        \node at (1.5,3.2) {USB 5V};
        
        % PC
        \draw[thick] (-2,-1) rectangle (2,-0.5);
        \node at (0,-0.75) {Ordinateur de développement};
        
        % Connexion USB
        \draw[thick] (0,0) -- (0,-0.5);
        \node at (-1,0) {USB};
        
    \end{tikzpicture}
    \caption{Architecture matérielle Community Edition}
    \label{fig:hardware-architecture-community}
\end{figure}

\subsection{Diagramme de flux éducatif}

\begin{figure}[h]
    \centering
    \begin{tikzpicture}[scale=0.7]
        % Boîtes
        \draw[thick] (0,6) rectangle (3,7) node[midway] {Installation};
        \draw[thick] (0,4.5) rectangle (3,5.5) node[midway] {Configuration};
        \draw[thick] (0,3) rectangle (3,4) node[midway] {Exercices guidés};
        \draw[thick] (0,1.5) rectangle (3,2.5) node[midway] {Expérimentation};
        \draw[thick] (0,0) rectangle (3,1) node[midway] {Projet personnel};
        
        % Flèches
        \draw[thick,->] (1.5,6) -- (1.5,5.5);
        \draw[thick,->] (1.5,4.5) -- (1.5,4);
        \draw[thick,->] (1.5,3) -- (1.5,2.5);
        \draw[thick,->] (1.5,1.5) -- (1.5,1);
        
        % Temps
        \node at (4,6.5) {30 min};
        \node at (4,5) {1 heure};
        \node at (4,3.5) {4-6 heures};
        \node at (4,2) {2-4 heures};
        \node at (4,0.5) {Variable};
        
    \end{tikzpicture}
    \caption{Flux d'apprentissage recommandé}
    \label{fig:learning-flow}
\end{figure>

\section{Résultats détaillés des tests}
\label{app:detailed-results}

\subsection{Métriques de performance complètes}

\begin{table}[h]
\centering
\caption{Résultats détaillés des tests de performance}
\label{tab:detailed-performance}
\begin{tabular}{|l|c|c|c|c|}
\hline
\textbf{Test} & \textbf{Min (ms)} & \textbf{Max (ms)} & \textbf{Moyenne (ms)} & \textbf{Écart-type} \\
\hline
SHA-256 (4KB) & 2.1 & 3.8 & 2.8 & 0.4 \\
ECDSA Sign & 45.2 & 67.3 & 52.1 & 5.8 \\
ECDSA Verify & 38.7 & 55.4 & 44.2 & 4.3 \\
Block Verification & 2.3 & 4.1 & 2.9 & 0.5 \\
Anomaly Detection & 12.4 & 18.7 & 15.1 & 2.1 \\
Random Generation (32B) & 0.9 & 1.6 & 1.2 & 0.2 \\
\hline
\end{tabular}
\end{table}

\subsection{Analyse statistique des faux positifs}

\begin{table}[h]
\centering
\caption{Distribution des faux positifs par cause}
\label{tab:false-positive-analysis}
\begin{tabular}{|l|c|c|c|}
\hline
\textbf{Cause} & \textbf{Occurrences} & \textbf{Pourcentage} & \textbf{Gravité} \\
\hline
Pics CPU temporaires & 15 & 34.9\% & Faible \\
Variations température & 10 & 23.3\% & Faible \\
Interférences Wi-Fi & 8 & 18.6\% & Moyenne \\
Fragmentation mémoire & 6 & 14.0\% & Faible \\
Autres causes & 4 & 9.3\% & Variable \\
\hline
\textbf{Total} & \textbf{43} & \textbf{100\%} & \\
\hline
\end{tabular}
\end{table>

\section{Guide d'installation détaillé}
\label{app:installation-guide}

\subsection{Prérequis système}

\textbf{Matériel requis :}
\begin{itemize}
    \item ESP32-WROOM-32 DevKit V1 (~5\$)
    \item DHT22 ou DHT11 (~3\$)
    \item Breadboard et câbles jumper (fourniture de base)
    \item Câble USB micro-B vers USB-A
    \item Ordinateur avec port USB libre
\end{itemize}

\textbf{Logiciels requis :}
\begin{itemize}
    \item ESP-IDF v4.4+ (gratuit)
    \item Python 3.7+ (généralement préinstallé)
    \item Pilotes USB-série (CP210x ou FTDI)
    \item Terminal série (intégré ESP-IDF)
\end{itemize}

\subsection{Procédure d'installation étape par étape}

\textbf{Étape 1 : Installation ESP-IDF}
\begin{enumerate}
    \item Télécharger ESP-IDF depuis le site officiel Espressif
    \item Suivre le guide d'installation pour votre OS
    \item Vérifier l'installation avec \texttt{idf.py --version}
\end{enumerate}

\textbf{Étape 2 : Configuration matérielle}
\begin{enumerate}
    \item Connecter DHT22 : VCC → 3.3V, GND → GND, Data → GPIO4
    \item Vérifier les connexions avec un multimètre si disponible
    \item Connecter ESP32 au PC via USB
\end{enumerate}

\textbf{Étape 3 : Compilation et flash}
\begin{enumerate}
    \item Cloner le repository SecureIoT-VIF Community
    \item \texttt{cd secureiot-vif-community}
    \item \texttt{idf.py build}
    \item \texttt{idf.py -p /dev/ttyUSB0 flash monitor}
\end{enumerate}

\section{Exercices pratiques}
\label{app:exercises}

\subsection{Exercice 1 : Configuration de base}

\textbf{Objectif :} Installer et configurer SecureIoT-VIF Community Edition

\textbf{Prérequis :} Installation ESP-IDF complète

\textbf{Durée estimée :} 45 minutes

\textbf{Instructions :}
\begin{enumerate}
    \item Suivre le guide d'installation (Annexe \ref{app:installation-guide})
    \item Compiler et flasher le firmware de base
    \item Observer les logs de démarrage sécurisé
    \item Identifier les messages de vérification d'intégrité
    \item Documenter les temps de démarrage mesurés
\end{enumerate}

\textbf{Questions de réflexion :}
\begin{itemize}
    \item Quelles sont les étapes de la chaîne de confiance observées ?
    \item Quel est l'impact du framework sur le temps de démarrage ?
    \item Comment les clés cryptographiques sont-elles générées ?
\end{itemize}

\subsection{Exercice 2 : Manipulation des seuils}

\textbf{Objectif :} Comprendre la détection d'anomalies par seuils fixes

\textbf{Prérequis :} Exercice 1 complété avec succès

\textbf{Durée estimée :} 90 minutes

\textbf{Instructions :}
\begin{enumerate}
    \item Modifier les seuils dans \texttt{secureiot\_config.h}
    \item Recompiler et reflasher
    \item Simuler des conditions anormales :
    \begin{itemize}
        \item Chauffer l'ESP32 (sèche-cheveux) pour trigger le seuil température
        \item Lancer des boucles intensives pour surcharger le CPU
        \item Allouer de la mémoire pour trigger le seuil mémoire
    \end{itemize}
    \item Observer et analyser les alertes générées
    \item Tester différentes valeurs de seuils
\end{enumerate}

\textbf{Questions de réflexion :}
\begin{itemize}
    \item Comment choisir des seuils appropriés ?
    \item Quels sont les avantages et inconvénients des seuils fixes ?
    \item Comment réduire les faux positifs ?
\end{itemize}

\subsection{Exercice 3 : Simulation d'attaques}

\textbf{Objectif :} Comprendre la détection de modifications de firmware

\textbf{Prérequis :} Exercices 1 et 2 complétés

\textbf{Durée estimée :} 2 heures

\textbf{Instructions :}
\begin{enumerate}
    \item Calculer le hash initial du firmware avec l'outil fourni
    \item Modifier artificiellement quelques bytes dans la flash
    \item Observer la détection lors de la vérification périodique
    \item Analyser les logs de détection d'intégrité
    \item Restaurer le firmware original
    \item Répéter avec différents types de modifications
\end{enumerate}

\textbf{Attaques à simuler :}
\begin{itemize}
    \item Modification d'un seul byte
    \item Modification de plusieurs bytes consécutifs
    \item Modification dans différentes sections (code, données, config)
    \item Injection de code simple (NOP slides)
\end{itemize}

\section{Ressources complémentaires}
\label{app:resources}

\subsection{Liens utiles}

\textbf{Documentation officielle :}
\begin{itemize}
    \item ESP-IDF Programming Guide : \url{https://docs.espressif.com/projects/esp-idf/}
    \item mbedTLS Documentation : \url{https://tls.mbed.org/}
    \item FreeRTOS Reference : \url{https://freertos.org/Documentation/}
\end{itemize}

\textbf{Communautés et forums :}
\begin{itemize}
    \item ESP32 Community Forum : \url{https://esp32.com/}
    \item Reddit r/esp32 : \url{https://reddit.com/r/esp32}
    \item Stack Overflow ESP32 Tag : \url{https://stackoverflow.com/questions/tagged/esp32}
\end{itemize}

\subsection{Bibliographie spécialisée}

Pour approfondir les concepts abordés dans SecureIoT-VIF Community Edition, nous recommandons la lecture des ouvrages et articles suivants :

\textbf{Sécurité IoT générale :}
\begin{itemize}
    \item "IoT Penetration Testing Cookbook" par Aaron Guzman
    \item "Practical IoT Hacking" par Fotios Chantzis
    \item "Building Secure Firmware" par Kai Michaelis
\end{itemize}

\textbf{Cryptographie embarquée :}
\begin{itemize}
    \item "A Graduate Course in Applied Cryptography" par Dan Boneh
    \item "Embedded Security in Cars" par Lemke, Paar, Wolf
    \item Publications récentes sur la cryptographie légère et post-quantique
\end{itemize}

\section{Licence et contribution}
\label{app:license}

\subsection{Licence d'utilisation}

SecureIoT-VIF Community Edition est distribué sous licence MIT, permettant :
\begin{itemize}
    \item Utilisation libre à des fins éducatives et de recherche
    \item Modification et redistribution avec attribution
    \item Utilisation commerciale avec les restrictions appropriées
    \item Contribution communautaire encouragée
\end{itemize}

\subsection{Comment contribuer}

Les contributions au projet SecureIoT-VIF Community Edition sont les bienvenues :

\textbf{Types de contributions appréciées :}
\begin{itemize}
    \item Corrections de bugs et améliorations du code
    \item Nouveaux exercices pédagogiques et scénarios
    \item Traductions de la documentation
    \item Portage vers d'autres plateformes (Arduino, Raspberry Pi)
    \item Amélioration de la documentation utilisateur
\end{itemize}

\textbf{Processus de contribution :}
\begin{enumerate}
    \item Fork du repository principal
    \item Création d'une branche dédiée pour la fonctionnalité
    \item Développement avec tests appropriés
    \item Documentation des modifications
    \item Pull request avec description détaillée
\end{enumerate}

Cette approche collaborative assure l'évolution continue du framework pour bénéficier à toute la communauté éducative en sécurité IoT.